/* src/index.css
   MB-BLUE-100.3 — 2025-12-31 (+0700)

   MERGED:
   (A) Mercy Blade background modes (rainbow / bw)
   (B) Mercy mouth + presence animations (SAFE)

   LOCKED POLICY:
   - Native <audio> UI must NEVER appear inside ROOM pages.
   - Audio is rendered ONLY via TalkingFacePlayButton (core Mercy Blade motif).

   CRITICAL FIX (97.4):
   - Native audio UI still rendering meant <audio> existed in DOM.
   - We do NOT disable audio playback logic.
   - We hide native audio UI ONLY inside `.mb-room` scope.

   FIX (100.2):
   - The “sticking out” blue rectangle is focus ring/outline on range inputs.
   - Remove outline/box-shadow focus rings for range inputs (safe, can style later).
   - Custom range appearance in WebKit so UI obeys parent clipping.

   FIX (100.3) — THE REAL OVERFLOW FIX FOR ROOM AUDIO BAR:
   - The room audio bar overflow is caused by GLOBAL `input[type=range]{ width:100% }`.
   - In a flex row (slider + time text), width:100% forces overflow to the right.
   - So we DO NOT force width:100% globally.
   - We clamp with max-width + min-width:0 + flex shrink safety instead.
   - Components that need full-width sliders (BottomMusicBar) already set width via inline/scoped CSS.
*/

/* ===============================
   Mercy Blade — Global Media Policy (LOCKED)
   =============================== */

/*
  Mercy Blade (LOCKED):
  - Native audio UI is forbidden INSIDE ROOMS.
  - Audio is rendered ONLY via TalkingFacePlayButton.
  - We hide native UI while keeping JS audio usable.
*/

/* ===============================
   ROOM-SCOPED AUDIO LOCK (THE LOOP BREAKER)
   =============================== */

/* 0) Scope marker: RoomRenderer uses `.mb-room`.
      Only enforce inside rooms, not admin panels. */
.mb-room audio {
  /* Defensive: if ANY <audio> exists, make it non-visual but playable */
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  overflow: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* 1) If controls attribute exists:
      DO NOT display:none (keeps DOM + avoids layout quirks).
      Visual is already suppressed by `.mb-room audio` above. */
.mb-room audio[controls] {
  display: block !important;
}

/* 2) WebKit native controls (Chrome/Safari) — extra defensive */
.mb-room audio::-webkit-media-controls,
.mb-room audio::-webkit-media-controls-enclosure,
.mb-room audio::-webkit-media-controls-panel,
.mb-room audio::-webkit-media-controls-play-button,
.mb-room audio::-webkit-media-controls-timeline,
.mb-room audio::-webkit-media-controls-current-time-display,
.mb-room audio::-webkit-media-controls-time-remaining-display,
.mb-room audio::-webkit-media-controls-mute-button,
.mb-room audio::-webkit-media-controls-volume-slider {
  display: none !important;
}

/* 3) If any renderer wraps audio in a container that has default margins,
      make sure it doesn't produce visual gaps. */
.mb-room audio,
.mb-room audio[controls] {
  margin: 0 !important;
  padding: 0 !important;
  border: 0 !important;
}

/* ===============================
   Mercy Blade — Color Modes
   =============================== */

/* Default: Rainbow mode */
:root[data-mb-mode="rainbow"] {
  --mb-bg: radial-gradient(
      1200px 600px at 10% 10%,
      rgba(255, 0, 160, 0.10),
      transparent 55%
    ),
    radial-gradient(
      1200px 600px at 90% 20%,
      rgba(0, 180, 255, 0.10),
      transparent 55%
    ),
    radial-gradient(
      1200px 600px at 40% 90%,
      rgba(140, 255, 0, 0.10),
      transparent 55%
    ),
    linear-gradient(180deg, rgba(250, 250, 252, 1), rgba(245, 246, 250, 1));
}

:root[data-mb-mode="bw"] {
  --mb-bg: linear-gradient(180deg, #ffffff, #f4f4f4);
}

body {
  background: var(--mb-bg);
}

/* optional: slightly richer card background in rainbow mode */
:root[data-mb-mode="rainbow"] .bg-card {
  background-color: rgba(255, 255, 255, 0.7);
}
:root[data-mb-mode="bw"] .bg-card {
  background-color: rgba(255, 255, 255, 1);
}

/* ===============================
   Mercy Blade Talking Mouth (SAFE)
   =============================== */

@keyframes mb-mouth-talk {
  0%,
  100% {
    transform: translateX(-50%) scaleY(0.2);
  }
  30% {
    transform: translateX(-50%) scaleY(1);
  }
  60% {
    transform: translateX(-50%) scaleY(0.4);
  }
}

/* Base mouth */
.mb-mouth {
  transform-origin: 50% 100%;
}

/* Apply this when audio playing */
.mb-mouth--talking {
  animation: mb-mouth-talk 0.35s ease-in-out infinite;
  will-change: transform;
}

/* Backward compat alias (optional) */
.animate-mouth-talk {
  animation: mb-mouth-talk 0.35s ease-in-out infinite;
  will-change: transform;
}

/* ===============================
   Mercy Breathing (Presence)
   =============================== */

@keyframes mercy-breathe {
  0%,
  100% {
    transform: scale(1);
    opacity: 0.9;
  }
  50% {
    transform: scale(1.03);
    opacity: 1;
  }
}

.animate-mercy-breathe {
  animation: mercy-breathe 4s ease-in-out infinite;
}

/* ===============================
   Halo Pulse (Reassurance)
   =============================== */

@keyframes halo-pulse {
  0%,
  100% {
    transform: scale(1);
    opacity: 0.6;
  }
  50% {
    transform: scale(1.15);
    opacity: 0.3;
  }
}

.animate-halo-pulse {
  animation: halo-pulse 3s ease-in-out infinite;
}

/* ===============================
   Wing Flutter (Angelic)
   =============================== */

@keyframes wing-flutter-left {
  0%,
  100% {
    transform: rotate(0deg);
  }
  50% {
    transform: rotate(-5deg);
  }
}

@keyframes wing-flutter-right {
  0%,
  100% {
    transform: rotate(0deg);
  }
  50% {
    transform: rotate(5deg);
  }
}

.animate-wing-flutter-left {
  animation: wing-flutter-left 2s ease-in-out infinite;
}

.animate-wing-flutter-right {
  animation: wing-flutter-right 2s ease-in-out infinite;
}

/* ===============================
   Wave Expansion (Abstract)
   =============================== */

@keyframes wave-expand {
  0%,
  100% {
    transform: scale(0.95);
    opacity: 0.8;
  }
  50% {
    transform: scale(1.05);
    opacity: 0.4;
  }
}

.animate-wave-expand {
  animation: wave-expand 3s ease-in-out infinite;
}

/* ===============================
   GLOBAL WIDTH CLAMPS (NO OVERFLOW)
   =============================== */

/* Prevent any media UI from exceeding its parent box. */
audio {
  display: block;
  max-width: 100%;
  box-sizing: border-box;
}

/*
  ✅ IMPORTANT:
  Do NOT force width:100% for all range inputs globally.
  That breaks flex rows (slider + time) and causes right-edge stick-out.
*/
input[type="range"] {
  max-width: 100%;
  min-width: 0;
  box-sizing: border-box;
  /* lets it behave in flex rows: take remaining space, not overflow */
  flex: 1 1 auto;
}

/* Flex/grid shrink safety: overflowing children is usually min-width:auto. */
.mb-room,
.mb-room * {
  min-width: 0;
}

/* ===============================
   RANGE FOCUS RING / OUTLINE CLIP FIX (THE STICK-OUT)
   =============================== */

/* The blue “sticking out” can be the focus outline/ring. */
input[type="range"]:focus {
  outline: none !important;
  box-shadow: none !important;
}

/* WebKit: force custom paint so it doesn't draw outside rounded parents. */
input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  background: transparent;
  margin: 0;
  padding: 0;
  height: 20px;
}

/* Track + thumb: neutral, safe */
input[type="range"]::-webkit-slider-runnable-track {
  height: 6px;
  border-radius: 9999px;
  background: rgba(0, 0, 0, 0.18);
}
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  border-radius: 9999px;
  background: rgba(0, 0, 0, 0.55);
  margin-top: -4px;
}

/* Firefox */
input[type="range"]::-moz-range-track {
  height: 6px;
  border-radius: 9999px;
  background: rgba(0, 0, 0, 0.18);
}
input[type="range"]::-moz-range-thumb {
  width: 14px;
  height: 14px;
  border-radius: 9999px;
  background: rgba(0, 0, 0, 0.55);
  border: 0;
}

/* New thing to learn:
   A global `width:100%` on inputs is dangerous in flex rows.
   Prefer `max-width:100% + min-width:0 + flex:1` so layouts can shrink safely. */
