#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Check if any JSON files in public/data have changed
if git diff --cached --name-only | grep -q "^public/data/.*\.json$"; then
  echo "ğŸ” Detected changes in room JSON files..."
  
  # Validate data files first
  echo "âœ… Validating JSON files..."
  node scripts/validate-data-files.js
  
  if [ $? -ne 0 ]; then
    echo "âŒ Validation failed! Please fix the errors above before committing."
    exit 1
  fi
  
  # Regenerate room registry
  echo "ğŸ“¦ Regenerating room registry..."
  node scripts/generate-room-registry.js
  
  # Add the generated files to the commit
  git add src/lib/roomManifest.ts src/lib/roomDataImports.ts
  
  echo "âœ… Room registry validated and updated"
fi
